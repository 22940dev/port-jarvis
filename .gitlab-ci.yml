image: node:alpine

variables:
  HUGO_VERSION: '0.51' # https://github.com/gohugoio/hugo/releases
  HUGO_SHA: '96579d81ea38e7ad5bc0bb675eff2be0d86d28e284cb43aa1893f627d07d4bda' # xxx_Linux-64bit.tar.gz

before_script:
  - apk update && apk add openssl coreutils
  - wget https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.tar.gz
  - echo "${HUGO_SHA}  hugo_${HUGO_VERSION}_Linux-64bit.tar.gz" | sha256sum -c
  - tar xf hugo_${HUGO_VERSION}_Linux-64bit.tar.gz && cp ./hugo /usr/bin
  - npm config set unsafe-perm true
  - npm install --quiet firebase-tools -g

deploy:
  stage: deploy
  script:
  - rm -rf public
  - hugo
  - firebase deploy --token $FIREBASE_TOKEN
