image: node:alpine

variables:
  HUGO_VERSION: '0.52' # https://github.com/gohugoio/hugo/releases
  HUGO_SHA: 'b4d1fe91023e3fe7e92953af12e08344d66ab10a46feb9cbcffbab2b0c14ba44' # xxx_Linux-64bit.tar.gz

before_script:
  - apk update && apk add openssl coreutils
  - wget https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.tar.gz
  - echo "${HUGO_SHA}  hugo_${HUGO_VERSION}_Linux-64bit.tar.gz" | sha256sum -c
  - tar xf hugo_${HUGO_VERSION}_Linux-64bit.tar.gz && cp ./hugo /usr/bin
  - npm config set unsafe-perm true
  - npm install --quiet firebase-tools -g

deploy:
  stage: deploy
  script:
  - rm -rf public
  - hugo
  - firebase deploy --token $FIREBASE_TOKEN
