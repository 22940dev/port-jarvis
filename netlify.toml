[build]
  command = "yarn build"
  publish = "public"

[build.environment]
  NODE_VERSION = "12.13.1"
  YARN_VERSION = "1.21.1"
  YARN_FLAGS = "--no-ignore-optional --frozen-lockfile"

# Ensure *only* Pretty URLs are enabled, even though this is already set up in
# the Netlify dashboard.
[build.processing]
  skip_processing = false
  [build.processing.css]
    bundle = false
    minify = false
  [build.processing.js]
    bundle = false
    minify = false
  [build.processing.html]
    pretty_urls = true
  [build.processing.images]
    compress = false

[context.deploy-preview]
  command = "yarn build:preview"


# The most important headers and redirects are specified in the _headers and
# _redirects files generated by Hugo. These are additional custom rules.

# PGP file: open in browser, download correctly
[[headers]]
  for = "/jarvis.asc"
  [headers.values]
    Cache-Control = "max-age=0, no-cache, no-store"
    Content-Type = "text/plain; charset=utf-8"
    Content-Disposition = "inline; filename=\"jarvis.asc\""

# Redirect default Netlify subdomain to primary domain:
[[redirects]]
  from = "https://jakejarvis.netlify.com/*"
  to = "https://jarv.is/:splat"
  status = 301
  force = true

# Support ancient RSS subscriptions from WordPress era:
[[redirects]]
  from = "/feed"
  to = "/feed.xml"
  status = 301
[[redirects]]
  from = "/rss"
  to = "/feed.xml"
  status = 301
[[redirects]]
  from = "/index.xml"
  to = "/feed.xml"
  status = 301

# Mirror these directories from elsewhere to mimic old GitHub Pages behavior
# and keep the main repository squeaky clean:
[[redirects]]
  from = "/y2k/*"
  to = "https://jakejarvis.github.io/y2k/:splat"
  status = 200
[[redirects]]
  from = "/ios-trackers/*"
  to = "https://jakejarvis.github.io/ios-trackers/:splat"
  status = 200
[[redirects]]
  from = "/scrabble/*"
  to = "https://modest-jackson-d5516b.netlify.com/scrabble/:splat"
  status = 200
[[redirects]]
  from = "/comp20/*"
  to = "https://modest-jackson-d5516b.netlify.com/comp20/:splat"
  status = 200
[[redirects]]
  from = "/candies/*"
  to = "https://modest-jackson-d5516b.netlify.com/candies/:splat"
  status = 200
[[redirects]]
  from = "/awesome/*"
  to = "https://modest-jackson-d5516b.netlify.com/awesome/:splat"
  status = 200

# H A C K E R M A N ( ͡° ͜ʖ ͡°)
[[redirects]]
  from = "*/wp-login.php"
  to = "/403.html"
  status = 403
  force = true
[[redirects]]
  from = "*/wp-admin/*"
  to = "/403.html"
  status = 403
  force = true
[[redirects]]
  from = "/login"
  to = "/403.html"
  status = 403
  force = true
[[redirects]]
  from = "*/login.php"
  to = "/403.html"
  status = 403
  force = true
