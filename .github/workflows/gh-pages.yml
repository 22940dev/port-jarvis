name: GitHub Pages

on:
  push:
    branches:
    - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
      with:
        fetch-depth: 1
        lfs: false
    # pull from custom Hugo Extended image with opinionated changes
    # Docker hub: https://hub.docker.com/r/jakejarvis/hugo-custom
    # base Dockerfile source: https://go.jarv.is/hugo-dockerfile
    - uses: docker://jakejarvis/hugo-custom:latest
      with:
        args: --gc --cleanDestinationDir
    - uses: jakejarvis/github-pages-deploy-action@master
      env:
        PAGES_TOKEN: ${{ secrets.GITHUB_ACCESS_TOKEN }}
        PAGES_CNAME: 'jarv.is'
        PAGES_SOURCE_FOLDER: 'public'
        PAGES_SOURCE_BRANCH: 'master'
        PAGES_TARGET_BRANCH: 'master'
        PAGES_TARGET_REPO: 'jakejarvis.github.io'
